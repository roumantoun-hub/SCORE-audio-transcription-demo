  // Function to generate and download a file
  const handleDownload = (file: GeneratedFile) => {
    // Generate mock file content based on file type
    let blob: Blob;
    
    if (file.format === 'MIDI') {
      // Create a simple MIDI file header (mock data)
      const midiHeader = new Uint8Array([
        0x4D, 0x54, 0x68, 0x64, 0x00, 0x00, 0x00, 0x06,
        0x00, 0x00, 0x00, 0x01, 0x00, 0x60, 0x4D, 0x54,
        0x72, 0x6B, 0x00, 0x00, 0x00, 0x04, 0x00, 0xFF,
        0x2F, 0x00
      ]);
      blob = new Blob([midiHeader], { type: 'audio/midi' });
    } else if (file.format === 'WAV') {
      // Create a minimal WAV file (1 second of silence)
      const sampleRate = 44100;
      const numChannels = 2;
      const bitsPerSample = 16;
      const duration = 1;
      const numSamples = sampleRate * duration;
      const blockAlign = numChannels * bitsPerSample / 8;
      const byteRate = sampleRate * blockAlign;
      const dataSize = numSamples * blockAlign;
      
      const buffer = new ArrayBuffer(44 + dataSize);
      const view = new DataView(buffer);
      
      const writeString = (offset: number, string: string) => {
        for (let i = 0; i < string.length; i++) {
          view.setUint8(offset + i, string.charCodeAt(i));
        }
      };
      
      writeString(0, 'RIFF');
      view.setUint32(4, 36 + dataSize, true);
      writeString(8, 'WAVE');
      writeString(12, 'fmt ');
      view.setUint32(16, 16, true);
      view.setUint16(20, 1, true);
      view.setUint16(22, numChannels, true);
      view.setUint32(24, sampleRate, true);
      view.setUint32(28, byteRate, true);
      view.setUint16(32, blockAlign, true);
      view.setUint16(34, bitsPerSample, true);
      writeString(36, 'data');
      view.setUint32(40, dataSize, true);
      
      blob = new Blob([buffer], { type: 'audio/wav' });
    } else if (file.format === 'PDF') {
      // Use utility function to generate a valid PDF
      blob = generateSimplePDF(file.name);
    } else if (file.format === 'LilyPond') {
      const lilypondContent = `\\version "2.20.0"
\\header {
  title = "${file.name.replace('.ly', '')}"
  composer = "Generated by SCORE"
}

\\score {
  \\new Staff {
    \\clef treble
    \\time 4/4
    c'4 d'4 e'4 f'4 |
    g'4 a'4 b'4 c''4 |
  }
  \\layout { }
  \\midi { }
}`;
      blob = new Blob([lilypondContent], { type: 'text/plain' });
    } else {
      const content = `Generated file: ${file.name}\nFormat: ${file.format}\nSize: ${file.size}\nGenerated at: ${file.generatedTime}`;
      blob = new Blob([content], { type: 'text/plain' });
    }
    
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = file.name;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };
